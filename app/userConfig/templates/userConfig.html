{% extends "base.html" %}

{% block head %}
<title>User Configuration</title>
<link rel="stylesheet" href="{{ url_for('userConfig.static', filename='css/userConfig.css') }}">
<script defer src="{{ url_for('userConfig.static', filename='js/userConfig.js') }}"></script>
{% endblock %}

{% block h1 %}
User Configuration
{% endblock %}

{% block block_container %}
<div class="user-config-form">
  <form id="userConfigForm">
    <div class="form-group">
      <label for="darkMode">Dark Mode</label>
      <select id="darkMode" name="darkMode">
        <option value="true" {{ 'selected' if userConfigs.darkMode == 'true' }}>ON</option>
        <option value="false" {{ 'selected' if userConfigs.darkMode == 'false' }}>OFF</option>
      </select>
    </div>
    <div class="form-group">
      <label for="alertsSound">Alerts Sound</label>
      <select id="alertsSound" name="alertsSound">
        <option value="true" {{ 'selected' if userConfigs.alertsSound == 'true' }}>ON</option>
        <option value="false" {{ 'selected' if userConfigs.alertsSound == 'false' }}>OFF</option>
      </select>
    </div>
    <div class="form-group">
      <label for="alerts">Alerts</label>
      <select id="alerts" name="alerts" multiple>
        <option value = "" {% if not userConfigs.alerts %}selected{% endif %}>None</option>
        {% set all_alert_types = [
          'speeding_alerts', 'harsh_break_alerts', 'harsh_acceleration_alerts', 'gsm_low_alerts',
          'internal_battery_low_alerts', 'idle_alerts', 'ignition_off_alerts', 'ignition_on_alerts', 'geofence_alerts'
        ] %}
        {% for alert in all_alert_types %}
        <option value="{{ alert }}" {% if alert in userConfigs.alerts %}selected{% endif %}>
          {{ alert.replace('_', ' ').title() }}
        </option>
        {% endfor %}
      </select>
    </div>
    <button type="submit" class="btn" id="saveConfigBtn">Save Configuration</button>
  </form>
</div>

<!-- Email Config Button -->
<div class="email-config-section">
  <button type="button" class="btn btn-secondary" id="emailConfigBtn">Email Configuration</button>
  
  <!-- Existing Emails Display -->
  <div class="existing-emails" id="existingEmails">
    {% if userConfigs.alert_emails %}
      {% for email in userConfigs.alert_emails %}
        <span class="email-tag">
          {{ email }}
          <span class="email-remove" data-email="{{ email }}">Ã—</span>
        </span>
      {% endfor %}
    {% endif %}
  </div>
</div>

<!-- Email Config Popup -->
<div class="modal-overlay" id="emailModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Email Configuration</h3>
      <button type="button" class="close-btn" id="closeModal">&times;</button>
    </div>
    <div class="modal-body">
      <form id="emailConfigForm">
        <div class="form-group">
          <label for="emailInput">Email Addresses (comma separated)</label>
          <textarea id="emailInput" name="emails" placeholder="Enter email addresses separated by commas"></textarea>
        </div>
        <div class="form-actions">
          <button type="submit" class="btn" id="saveEmailsBtn">Save Emails</button>
          <button type="button" class="btn btn-cancel" id="cancelModal">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>

{% endblock %}