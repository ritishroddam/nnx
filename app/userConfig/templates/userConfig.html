{% extends "base.html" %}

{% block head %}
<title>User Configuration</title>
<link rel="stylesheet" href="{{ url_for('userConfig.static', filename='css/userConfig.css') }}">
<script defer src="{{ url_for('userConfig.static', filename='js/userConfig.js') }}"></script>
{% endblock %}

{% block h1 %}
User Configuration

 <!-- Email Configuration Section -->
    <div class="form-group">
      <label>Email Alerts</label>
      <button type="button" id="emailConfigBtn" class="btn btn-secondary">Email Config</button>
      <div id="emailTagsContainer" class="email-tags-container">
        {% if userConfigs.emailAlerts %}
          {% for email in userConfigs.emailAlerts %}
            <span class="email-tag">
              {{ email }}
              <span class="email-tag-remove" data-email="{{ email }}">Ã—</span>
            </span>
          {% endfor %}
        {% endif %}
      </div>
    </div>
{% endblock %}

{% block block_container %}
<div class="user-config-form">
  <form id="userConfigForm">
    <div class="form-group">
      <label for="darkMode">Dark Mode</label>
      <select id="darkMode" name="darkMode">
        <option value="true" {{ 'selected' if userConfigs.darkMode == 'true' }}>ON</option>
        <option value="false" {{ 'selected' if userConfigs.darkMode == 'false' }}>OFF</option>
      </select>
    </div>
    <div class="form-group">
      <label for="alertsSound">Alerts Sound</label>
      <select id="alertsSound" name="alertsSound">
        <option value="true" {{ 'selected' if userConfigs.alertsSound == 'true' }}>ON</option>
        <option value="false" {{ 'selected' if userConfigs.alertsSound == 'false' }}>OFF</option>
      </select>
    </div>
    <div class="form-group">
      <label for="alerts">Alerts</label>
      <select id="alerts" name="alerts" multiple>
        <option value = "" {% if not userConfigs.alerts %}selected{% endif %}>None</option>
        {% set all_alert_types = [
          'speeding_alerts', 'harsh_break_alerts', 'harsh_acceleration_alerts', 'gsm_low_alerts',
          'internal_battery_low_alerts', 'idle_alerts', 'ignition_off_alerts', 'ignition_on_alerts'
        ] %}
        {% for alert in all_alert_types %}
        <option value="{{ alert }}" {% if alert in userConfigs.alerts %}selected{% endif %}>
          {{ alert.replace('_', ' ').title() }}
        </option>
        {% endfor %}
      </select>
    </div>
    
    <button type="submit" class="btn" id="saveConfigBtn">Save Configuration</button>
  </form>
</div>

<!-- Email Configuration Modal -->
<div id="emailConfigModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Email Configuration</h3>
      <span class="close">&times;</span>
    </div>
    <div class="modal-body">
      <p>Enter email addresses (comma separated):</p>
      <textarea id="emailInput" placeholder="e.g., user1@example.com, user2@example.com" rows="4"></textarea>
      <div class="modal-actions">
        <button type="button" id="saveEmailsBtn" class="btn">Save Emails</button>
        <button type="button" id="cancelEmailsBtn" class="btn btn-secondary">Cancel</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}