{% extends "base.html" %}

{% block head %}
<title>Alerts</title>
<link rel="stylesheet" href="{{ url_for('Alerts.static', filename='css/alert.css') }}">
<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.6/js/standalone/selectize.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.6/css/selectize.bootstrap3.min.css">
<script defer src="{{ url_for('Alerts.static', filename='js/alert.js') }}"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<style>
.loading-animation {
    display: flex;
    justify-content: center;
    padding: 40px 0;
}

.loading-spinner {
    width: 50px;
    height: 50px;
    border: 3px solid rgba(0, 0, 0, 0.1);
    border-radius: 50%;
    border-top-color: #3498db;
    animation: spin 1s ease-in-out infinite;
    position: relative;
}

.loading-spinner:after {
    content: '';
    position: absolute;
    top: 5px;
    left: 5px;
    right: 5px;
    bottom: 5px;
    border: 3px solid rgba(0, 0, 0, 0.1);
    border-radius: 50%;
    border-top-color: #e74c3c;
    animation: spin 1.5s ease-in-out infinite;
}

.loading-spinner:before {
    content: '';
    position: absolute;
    top: 12px;
    left: 12px;
    right: 12px;
    bottom: 12px;
    border: 3px solid rgba(0, 0, 0, 0.1);
    border-radius: 50%;
    border-top-color: #f39c12;
    animation: spin 2s ease-in-out infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 20px 0;
    gap: 5px;
}

.pagination button {
    min-width: 36px;
    height: 36px;
    padding: 0 10px;
    border: 1px solid #ddd;
    background: #fff;
    color: #333;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
}

.pagination button:hover:not(:disabled) {
    background: #f5f5f5;
}

.pagination button.active {
    background: #3498db;
    color: white;
    border-color: #3498db;
}

.pagination button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

.pagination span {
    padding: 0 10px;
}

.error-message {
    text-align: center;
    padding: 20px;
    color: #dc3545;
}

.toast-notification {
    position: fixed;
    bottom: 20px;
    right: 20px;
    padding: 15px 20px;
    border-radius: 5px;
    color: white;
    display: flex;
    align-items: center;
    gap: 10px;
    opacity: 0;
    transform: translateY(20px);
    transition: all 0.3s ease;
    z-index: 1000;
}

.toast-notification.show {
    opacity: 1;
    transform: translateY(0);
}

.toast-notification.success {
    background-color: #28a745;
}

.toast-notification.error {
    background-color: #dc3545;
}

.toast-notification.info {
    background-color: #17a2b8;
}

.toast-notification i {
    font-size: 20px;
}

.alerts-table-container {
    max-height: calc(100vh - 250px);
    overflow-y: auto;
    position: relative;
}

.download-btn {
    padding: 8px 16px;
    background-color: #28a745;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.2s;
}

.download-btn:hover {
    background-color: #218838;
}
</style>
{% endblock %}

{% block h1 %}
Alerts
{% endblock %}

{% block block_container %}

<div class="alerts-container">
    <div class="alert-sidebar">
        <div class="alert-cards">
            <div class="alert-type-header">ALERT TYPES</div>
            
            <div class="alert-card active" data-alert="panic" data-endpoint="panic">
                <h3>Panic Alert</h3>
                <i class="fa-solid fa-triangle-exclamation"></i>
            </div>
            <div class="alert-card" data-alert="speeding" data-endpoint="speeding">
                <h3>Speeding Alert</h3>
                <i class="fa-solid fa-gauge-high"></i>
            </div>
            <div class="alert-card" data-alert="harsh_break" data-endpoint="harsh_break">
                <h3>Harsh Break Alert</h3>
                <i class="fa-solid fa-car-burst"></i>
            </div>
            <div class="alert-card" data-alert="harsh_acceleration" data-endpoint="harsh_acceleration">
                <h3>Harsh Acceleration Alert</h3>
                <i class="fa-solid fa-car-rear"></i>
            </div>
            <div class="alert-card" data-alert="gsm_low" data-endpoint="gsm_low">
                <h3>GSM Signal Low Alert</h3>
                <i class="fa-solid fa-signal"></i>
            </div>
            <div class="alert-card" data-alert="internal_battery_low" data-endpoint="internal_battery_low">
                <h3>Internal Battery Low Alert</h3>
                <i class="fa-solid fa-battery-quarter"></i>
            </div>
            <div class="alert-card" data-alert="main_power_off" data-endpoint="main_power_off">
                <h3>Main Supply Remove Alert</h3>
                <i class="fa-solid fa-plug-circle-xmark"></i>
            </div>
            <div class="alert-card" data-alert="idle" data-endpoint="idle">
                <h3>Idle Alert</h3>
                <i class="fa-solid fa-hourglass-half"></i>
            </div>
            <div class="alert-card" data-alert="ignition_off" data-endpoint="ignition_off">
                <h3>Ignition Off Alert</h3>
                <i class="fa-solid fa-key"></i>
            </div>
            <div class="alert-card" data-alert="ignition_on" data-endpoint="ignition_on">
                <h3>Ignition On Alert</h3>
                <i class="fa-solid fa-key"></i>
            </div>
        </div>
    </div>

    <!-- Main content area with alerts table (80%) -->
    <div class="alerts-main-content">
        <div class="alerts-filter">
            <div class="filter-group">
                <label for="alertDateRange">Showing Alerts from:</label>
                <input type="datetime-local" id="startDate" value="{{ default_start_date }}">
                <span>to</span>
                <input type="datetime-local" id="endDate" value="{{ default_end_date }}">
            </div>
            <div class="filter-group">
                <label for="alertVehicleNumber">Vehicle:</label>
                <select id="alertVehicleNumber" name="vehicleNumber">
                    <option value="">All Vehicles</option>
                    {% for vehicle in vehicles %}
                    <option value="{{ vehicle.LicensePlateNumber }}">{{ vehicle.LicensePlateNumber }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="filter-group">
                <button id="downloadAlerts" class="download-btn">Download Excel</button>
            </div>
            <button id="searchAlerts" class="search-btn">Search</button>
        </div>

        <div class="alerts-table-container">
            <table id="alertsTable" class="alerts-table">
                <thead>
                    <tr>
                        <th>Vehicle Number</th>
                        <th>Driver</th>
                        <th>Alert Type</th>
                        <th>Time</th>
                        <th>Location</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Alerts will be populated here by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Acknowledgment Modal -->
<div id="ackModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Panic Acknowledgement</h2>
        <form id="ackForm">
            <div class="form-group">
                <label>Pressed For</label>
                <select id="pressedFor" required>
                    <option value="">Select the Reason</option>
                    <option value="panic_test">Panic Test / Pressed by Mistake</option>
                    <option value="emergency">Emergency</option>
                    <option value="auto_panic">Auto Panic Test</option>
                    <option value="other">Other</option>
                </select>
            </div>
            <div class="form-group">
                <label>Reason</label>
                <textarea id="ackReason" rows="3" placeholder="Enter reason (optional)"></textarea>
            </div>
            <div class="form-actions">
                <button type="button" class="cancel-btn">Close</button>
                <button type="submit" class="ack-submit-btn">Acknowledge</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}